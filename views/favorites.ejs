<%- include('partials/header.ejs') %>
<%- include('partials/nav.ejs') %>

<div class="mainBox">
    <h1>Your Favorite Recipes</h1>

    <% if (favorites.length === 0) { %>
        <p>No favorites yet. Start adding recipes from your search results!</p>
    <% } else { %>
        <p><%= favorites.length %> favorite recipe(s)</p>
        
        <div class="recipe-list">
            <% for (let recipe of favorites) { %>
                <div class="recipe-card">
                    <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 10px;">
                        <a href="/api/favorites/delete?recipe_id=<%= recipe.recipe_id %>" 
                           style="display: flex; align-items: center; cursor: pointer; font-weight: bold; color: #d32f2f; text-decoration: none; padding: 5px 10px; border: 1px solid #d32f2f; border-radius: 4px;">
                            Remove from Favorites
                        </a>
                    </div>
                    
                    <img src="<%= recipe.img_url %>" alt="<%= recipe.title %>">
                    <h2><%= recipe.title %></h2>
                    <p><strong>üçΩÔ∏è Cuisine:</strong> <%= recipe.cuisine %></p>
                    <p><strong>üç¥ Meal Type:</strong> <%= recipe.meal_type %></p>
                    <p><strong>ü•ó Diet:</strong> <%= recipe.diet %></p>
                    <p><strong>üí≤ Price:</strong> $<%= recipe.price ? parseFloat(recipe.price).toFixed(2) : '0.00' %></p>
                    <p><strong>‚è±Ô∏è Cook Time:</strong> <%= recipe.cook_time %> minutes</p>
                    
                    <div class="nutrition">
                        <span>Fat: <%= recipe.fat || 0 %>g</span>
                        <span>Carbs: <%= recipe.carb || 0 %>g</span>
                        <span>Protein: <%= recipe.protein || 0 %>g</span>
                    </div>
                    
                    <% if (recipe.source === 'web' && recipe.instructions.includes('See source URL')) { %>
                        <a href="https://spoonacular.com/recipes/<%= recipe.title.toLowerCase().replace(/\s+/g, '-') %>-<%= recipe.recipe_id %>" target="_blank" style="display: inline-block; margin-top: 10px; padding: 10px 15px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">
                            View Full Recipe ‚Üí
                        </a>
                    <% } else { %>
                        <% if (recipe.ingredients) { %>
                            <p><strong>Ingredients:</strong> <%= recipe.ingredients %></p>
                        <% } %>
                        <% if (recipe.instructions) { %>
                            <p><strong>Instructions:</strong> <%= recipe.instructions %></p>
                        <% } %>
                    <% } %>
                </div>
            <% } %>
        </div>
    <% } %>

    <a href="/" class="btn btn-light back-btn">‚Üê Back to Search</a>
</div>

<%- include('partials/footer.ejs') %>
