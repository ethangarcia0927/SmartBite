<%- include('partials/header.ejs') %>
<%- include('partials/nav.ejs') %>



<div class="mainBox">
    <h1>Recipes Found</h1>

    <% if (recipes.length === 0) { %>
        <p>No recipes found matching your search.</p>
    <% } else { %>
        <p><%= recipes.length %> recipe(s) found</p>
        
        <div class="recipe-list">
            <% for (let recipe of recipes) { %>
                <div class="recipe-card">
                    <% if (recipe.source === 'web') { %>
                        <!-- Web Search Result (Spoonacular) -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div class="source-badge" style="background: #FF9800; color: white; padding: 5px 10px; display: inline-block; border-radius: 4px; font-weight: bold;">
                                üåê Web Recipe
                            </div>
                            <% if (typeof user_id !== 'undefined' && user_id) { %>
                                <label style="display: flex; align-items: center; cursor: pointer; font-weight: bold;">
                                    <input type="checkbox" class="favorite-checkbox" 
                                           data-recipe-id="<%= recipe.recipe_id %>" 
                                           data-recipe-source="web"
                                           data-recipe-title="<%= recipe.title.replace(/"/g, '&quot;') %>"
                                           data-recipe-cuisine="<%= recipe.cuisine %>"
                                           data-recipe-meal-type="<%= recipe.meal_type %>"
                                           data-recipe-diet="<%= recipe.diet %>"
                                           data-recipe-price="<%= recipe.price %>"
                                           data-recipe-cook-time="<%= recipe.cook_time %>"
                                           data-recipe-img-url="<%= recipe.img_url %>"
                                           data-recipe-fat="<%= recipe.fat || 0 %>"
                                           data-recipe-carb="<%= recipe.carb || 0 %>"
                                           data-recipe-protein="<%= recipe.protein || 0 %>"
                                           style="margin-right: 5px; width: 18px; height: 18px; cursor: pointer;">
                                    Add to Favorites
                                </label>
                            <% } %>
                        </div>
                        <img src="<%= recipe.img_url %>" alt="<%= recipe.title %>">
                        <h2><%= recipe.title %></h2>
                        <p><strong>üçΩÔ∏è Cuisine:</strong> <%= recipe.cuisine %></p>
                        <p><strong>üç¥ Meal Type:</strong> <%= recipe.meal_type %></p>
                        <p><strong>ü•ó Diet:</strong> <%= recipe.diet %></p>
                        <% if (recipe.price && parseFloat(recipe.price) > 0) { %>
                            <p><strong>üí≤ Price per serving:</strong> $<%= parseFloat(recipe.price).toFixed(2) %></p>
                        <% } %>
                        <% if (recipe.cook_time && recipe.cook_time > 0) { %>
                            <p><strong>‚è±Ô∏è Ready in:</strong> <%= recipe.cook_time %> minutes</p>
                        <% } %>
                        
                        <% if (recipe.fat || recipe.carb || recipe.protein) { %>
                            <div class="nutrition">
                                <span>Fat: <%= recipe.fat || 0 %>g</span>
                                <span>Carbs: <%= recipe.carb || 0 %>g</span>
                                <span>Protein: <%= recipe.protein || 0 %>g</span>
                            </div>
                        <% } %>
                        
                        <% if (recipe.sourceUrl) { %>
                            <a href="<%= recipe.sourceUrl %>" target="_blank" style="display: inline-block; margin-top: 10px; padding: 10px 15px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">
                                View Full Recipe ‚Üí
                            </a>
                        <% } %>
                    <% } else { %>
                        <!-- Community Search Result (Local Database) -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div class="source-badge" style="background: #4CAF50; color: white; padding: 5px 10px; display: inline-block; border-radius: 4px; font-weight: bold;">
                                üë• Community Recipe
                            </div>
                            <% if (typeof user_id !== 'undefined' && user_id) { %>
                                <label style="display: flex; align-items: center; cursor: pointer; font-weight: bold;">
                                    <input type="checkbox" class="favorite-checkbox" 
                                           data-recipe-id="<%= recipe.recipe_id %>" 
                                           data-recipe-source="community"
                                           <%= isFavorited && isFavorited[recipe.recipe_id] ? 'checked' : '' %>
                                           style="margin-right: 5px; width: 18px; height: 18px; cursor: pointer;">
                                    Add to Favorites
                                </label>
                            <% } %>
                        </div>
                        <img src="<%= recipe.img_url %>" alt="<%= recipe.title %>">
                        <h2><%= recipe.title %></h2>
                        <p><strong>üçΩÔ∏è Cuisine:</strong> <%= recipe.cuisine %></p>
                        <p><strong>üç¥ Meal Type:</strong> <%= recipe.meal_type %></p>
                        <p><strong>ü•ó Diet:</strong> <%= recipe.diet %></p>
                        <p><strong>üí≤ Price:</strong> $<%= recipe.price ? parseFloat(recipe.price).toFixed(2) : '0.00' %></p>
                        <p><strong>‚è±Ô∏è Cook Time:</strong> <%= recipe.cook_time %> minutes</p>
                        
                        <% if (recipe.fat || recipe.carb || recipe.protein) { %>
                            <div class="nutrition">
                                <span>Fat: <%= recipe.fat || 0 %>g</span>
                                <span>Carbs: <%= recipe.carb || 0 %>g</span>
                                <span>Protein: <%= recipe.protein || 0 %>g</span>
                            </div>
                        <% } %>
                        
                        <% if (recipe.ingredients) { %>
                            <p><strong>Ingredients:</strong> <%= recipe.ingredients %></p>
                        <% } %>
                        <% if (recipe.instructions) { %>
                            <p><strong>Instructions:</strong> <%= recipe.instructions %></p>
                        <% } %>
                    <% } %>
                </div>
            <% } %>
        </div>
    <% } %>

    <a href="/" class="btn btn-light back-btn">‚Üê Back to Search</a>


</div>

<%- include('partials/footer.ejs') %>
